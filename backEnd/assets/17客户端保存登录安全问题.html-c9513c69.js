import{_ as n,p as a,q as s,a1 as e}from"./framework-96b046e1.js";const t={},p=e(`<h1 id="_17-客户端保存登录安全问题" tabindex="-1"><a class="header-anchor" href="#_17-客户端保存登录安全问题" aria-hidden="true">#</a> 17 客户端保存登录安全问题</h1><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">/*
注意点: 由于Cookie既可以在服务端修改, 又可以在客户端修改, 所以存在安全隐患
        所以我们在服务端设置Cookie的时候, 可以通过httpOnly来指定只能在服务端修改
        不能在客户端修改
注意点: 虽然我们通过服务端保存了登录状态, 但是并没有给登录状态设置过期时间,
        所以还是存在安全隐患, 所以我们在保存登录状态的时候, 还需要设置过期时间
注意点: 在客户端保存用户的用户名明文其实也是不安全的, 所以在在保存登录状态的时候
        应该加密之后再保存
* */</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_01-客户端可修改" tabindex="-1"><a class="header-anchor" href="#_01-客户端可修改" aria-hidden="true">#</a> 01 客户端可修改</h2><p>客户端可以通过以下方式在浏览器输出窗口修改cookie，所以存在安全问题！</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>document<span class="token punctuation">.</span>cookie <span class="token operator">=</span> <span class="token string">&#39;username=xxx;path=/&#39;</span>
<span class="token comment">// 可以再浏览器输出窗口操作，所以存在安全问题</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>解决方法</strong></p><p>通过以下<code>httpOnly</code>设置，设置cookie只能在服务端修改！设置后不能通过<code>document.cookie</code>在浏览器输出窗口更改了。但是经过自己的测试好像依然能通过Application下的cookie界面进行修改。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Set-Cookie&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">username=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;path=/;httpOnly</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token comment">// 服务端代码</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_02-设置过期时间" tabindex="-1"><a class="header-anchor" href="#_02-设置过期时间" aria-hidden="true">#</a> 02 设置过期时间</h2><p>通过关键字<code>expires</code>设置过期时间，解决第二个隐患</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Set-Cookie&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">username=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;path=/;httpOnly;expires=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>getCookieExpires<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">getCookieExpires</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">let</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    date<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">24</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">60</span><span class="token operator">*</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> date<span class="token punctuation">.</span><span class="token function">toGMTString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_03-username保存为密文" tabindex="-1"><a class="header-anchor" href="#_03-username保存为密文" aria-hidden="true">#</a> 03 username保存为密文</h2><p>保存为密文，解决第三个安全隐患。</p><p>通过 <code>generatePwd</code> 方法把username进行加密，防止在客户端看到username随意修改。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Set-Cookie&#39;</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">username=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">generatePwd</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;path=/;httpOnly;expires=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token function">getCookieExpires</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>generatePwd的实现见<code>041 密码加密</code>。</p>`,17),o=[p];function i(c,l){return a(),s("div",null,o)}const r=n(t,[["render",i],["__file","17客户端保存登录安全问题.html.vue"]]);export{r as default};
