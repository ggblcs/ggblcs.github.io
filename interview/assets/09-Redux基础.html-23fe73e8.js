import{_ as p,M as o,p as c,q as l,R as n,t as s,N as t,Q as i,a1 as a}from"./framework-96b046e1.js";const r={},u=n("h1",{id:"_09-redux基础",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_09-redux基础","aria-hidden":"true"},"#"),s(" 09 -Redux基础")],-1),d=n("hr",null,null,-1),k=n("h2",{id:"为什么要用-redux",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#为什么要用-redux","aria-hidden":"true"},"#"),s(" 为什么要用 Redux")],-1),v=n("p",null,"**目标：**能够说出为什么需要使用 Redux",-1),m={href:"http://cn.redux.js.org/",target:"_blank",rel:"noopener noreferrer"},b=a("<blockquote><p>起源</p></blockquote><p>React 本身只是一个用于构建界面的库，并不是整个 Web 应用开发的完整方案。因此，以前用 React 开发应用时，如果涉及到数据处理、跨组件通信时，就需要自己来处理，比较麻烦：</p><ul><li>对于大型应用来说，数据处理和组件通信这两方面恰恰是非常关键的。如果只用 React，那么编写大型应用会比较吃力，React 本身在这方面的能力较弱，因为它本来并不关注这些功能</li><li>2014 年 Facebook 提出了 Flux 架构的概念，它是一套状态管理的编程思想。一段时间后又实现了同名的状态管理工具库：Flux</li><li>2015 年，Redux 状态管理库出现，它借用了 Flux 思想并结合了函数式编程思想，一推出就大受欢迎</li><li>除了 Flux 和 Redux，React 社区还有其他优秀的状态管理工具，如： Mobx（和 Vuex 类似）</li></ul><p><strong>问题：为什么要用 Redux?</strong></p><p>不使用 Redux 时 (下左图) ：</p><ul><li>只能使用父子组件通讯、状态提升等 React 自带机制</li><li>处理远房亲戚(非父子)关系的组件通讯时乏力</li><li>组件之间的数据流混乱，出现 Bug 时难定位</li></ul><p>使用 Redux 后 (下右图)：</p><ul><li>集中式存储和管理应用的状态</li><li>处理组件通讯问题时，无视组件之间的层级关系</li><li>简化大型复杂应用中组件之间的通讯问题</li><li>数据流清晰，易于定位 Bug</li></ul>",8),g=a(`<hr><h2 id="redux-简单小示例" tabindex="-1"><a class="header-anchor" href="#redux-简单小示例" aria-hidden="true">#</a> Redux 简单小示例</h2><p><strong>目标：</strong> 观看一个最简单的使用 Redux 共享数据的小示例</p><p>步骤：</p><ol><li>安装 Redux 包：<code>yarn add redux</code></li><li>配置 Redux</li><li>编写2个组件：一个组件从 Redux 中获取数据，一个组件向 Redux 中存入数据</li></ol><hr><h2 id="redux-核心概念-概述" tabindex="-1"><a class="header-anchor" href="#redux-核心概念-概述" aria-hidden="true">#</a> Redux 核心概念-概述</h2><p>**目标：**能够理解 Redux 三个核心概念的职责</p><p>Redux 使用了三个概念， <strong>让各部分代码职责分明</strong>：</p><ul><li><strong>Action</strong>：“动作”，其实就是要做的事情</li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;user/login&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Reducer</strong>：“缩减器”，按 Action 的指示，处理老状态，得到新状态，并存入 Store</li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code>相当于 Vuex 中的 mutations 方法
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>Store</strong>：“仓库”，所有状态及用来改变状态的 Reducer 都存放在仓库里</li></ul><p>!---<a href="images/ReduxDataFlow.gif">ReduxDataFlow</a></p><blockquote><p>生活小例子：</p><ul><li>Store：公司老板</li><li>Action：老板发的邮件，邮件内容可能是：快去写代码、快去测试界面</li><li>Reducer：公司员工，按老板发的邮件内容干活，干完活反馈给老板</li></ul></blockquote><hr><h2 id="redux-action" tabindex="-1"><a class="header-anchor" href="#redux-action" aria-hidden="true">#</a> Redux：Action</h2><p><strong>目标</strong>：定义一个最基本的 action</p><p>Action 意为”行动“，即表示要做的事情。</p><p>项目中的每一个功能都可算作是一个 Action，比如：</p><ul><li>计数器案例：计数器的 +1/-1 操作</li><li>todomvc 案例：添加任务、删除任务等</li><li>登录、注册、登出操作等</li></ul><p>Action 的特点：</p><ul><li>它只管描述要做什么事，但不描述怎么做这件事的细节步骤</li><li>它是一个 JS 对象，且须带有 <code>type</code> 属性，用来区分不同的事情（即这件事的名字）</li><li>根据事情的不同，可为 Action 对象携带和这件事有关的数据 (称为 payload)</li></ul><p>示例：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 计数器</span>
<span class="token punctuation">{</span> type： <span class="token string">&#39;increment&#39;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> type： <span class="token string">&#39;decrement&#39;</span><span class="token punctuation">,</span> payload： <span class="token number">2</span> <span class="token punctuation">}</span>

<span class="token comment">// todomvc</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;addTodo&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">&#39;吃饭&#39;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;addTodo&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token string">&#39;睡觉&#39;</span> <span class="token punctuation">}</span>
<span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;removeTodo&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">payload</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redux-action-creator" tabindex="-1"><a class="header-anchor" href="#redux-action-creator" aria-hidden="true">#</a> Redux：Action Creator</h2><p><strong>目标</strong>：将动态创建 Action 对象的过程封装在一个函数中</p><p>直接使用对象创建 Action 的方式比较不灵活，因为属性都写死了。所以，一般会用函数来创建 Action，这样可以通过计算，最终得到不同的 Action 对象。</p><p>这种专门用来创建 Action 的函数，被称为 Action Creator：</p><ol><li>Action Creator 函数的返回值是一个 Action 对象</li><li>Action Creator 函数的好处是更容易被移植和测试</li></ol><p><strong>核心代码</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 一个 Action 对象</span>
<span class="token keyword">const</span> increment <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;INCREMENT&#39;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 一个 Action Creator 函数，返回 Action 对象</span>
<span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;INCREMENT&#39;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 一个简化版的 Action Creator 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">increment</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;INCREMENT&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ---------------------------------------------------------</span>
<span class="token comment">// 写死的 Action 对象</span>
<span class="token keyword">const</span> addTodo <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;ADD_TODO&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">text</span><span class="token operator">:</span> <span class="token string">&#39;加班&#39;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 动态生成 Action 对象的 Action Creator 函数</span>
<span class="token keyword">const</span> <span class="token function-variable function">addTodo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">text</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;ADD_TODO&#39;</span><span class="token punctuation">,</span>
  text
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">&#39;加班&#39;</span><span class="token punctuation">)</span>
<span class="token function">addTodo</span><span class="token punctuation">(</span><span class="token string">&#39;下课&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redux-reducer" tabindex="-1"><a class="header-anchor" href="#redux-reducer" aria-hidden="true">#</a> Redux：Reducer</h2><p>**目标：**掌握 Reducer 函数的基本写法</p><p>Reducer 是一个普通的函数，<strong>专门用来接收 Action 并生成新的状态</strong>。它是 Redux 进行状态更新的地方（类似 Vuex 的 Mutations）。</p><p>Reducer 函数的格式：<code>function xxx(state, action) { return newState }</code></p><ul><li>它接收上一次的状态及当前 Action 对象作为参数，然后根据 Action 中提供的信息（type、payload），执行不同的逻辑，生成一个新状态后返回</li><li>它必须是一个<strong>纯函数</strong>，且只做一件事：接收旧的 state 和 action，生成并返回新的 state</li></ul><p><strong>核心代码</strong></p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loginReducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 处理各种各样的 Action</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;addOne&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;subOne&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
  
  
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;addOne&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
      
    <span class="token keyword">case</span> <span class="token string">&#39;subOne&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
      
    <span class="token keyword">case</span> <span class="token string">&#39;addMore&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
      
    <span class="token keyword">case</span> <span class="token string">&#39;subMore&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> action<span class="token punctuation">.</span>payload
      
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// 默认值</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redux-纯函数和reducer" tabindex="-1"><a class="header-anchor" href="#redux-纯函数和reducer" aria-hidden="true">#</a> Redux：纯函数和Reducer</h2><p>**目标：**了解什么叫“纯函数”</p><p>纯函数是 <em><strong>函数式编程</strong></em> 思想中提出的概念，它在普通函数的基础上，做了一些更为严格的规定：</p><ul><li>如果输入参数相同，那得到的返回值也总是相同的</li><li>不得调用 <code>Date.now()</code> 或 <code>Math.random()</code> 之类不纯的方法（因为会造成每次得到不同的结果）</li><li>不得对参数进行修改</li><li>不能使用全局变量</li></ul><p>示例代码：</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token comment">// 一个纯函数</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 3</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// 3</span>


<span class="token comment">// 一个不纯的函数</span>
<span class="token keyword">function</span> <span class="token function">add</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// ??</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// ??</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>想一想：数组的方法 <code>pop push slice splice</code> 中，哪些属于纯函数?</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
arr<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 

arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Redux 的 Reducer 函数必须遵循以下规则：</strong></p><ul><li>必须是纯函数</li><li>不能有副作用（异步调用、本地存储、访问全局变量等操作）</li></ul><hr><h2 id="redux-store" tabindex="-1"><a class="header-anchor" href="#redux-store" aria-hidden="true">#</a> Redux：Store</h2><p>**目标：**通过 store 关联 action 和 reducer</p><p>Store 即状态仓库。它是 Redux 的核心，由它来整合所有的 Action 和 Reducer 一起进行状态管理。</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span>
<span class="token keyword">import</span> reducer <span class="token keyword">from</span> <span class="token string">&#39;./reducer&#39;</span>

<span class="token comment">// 创建 Store，并传入 Reducer 函数</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> store
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Store 的特点：</strong></p><ul><li>一个应用只有一个 Store</li><li>创建 store 时应接收 Reducer 函数作为参数：<code>const store = createStore(reducer)</code></li></ul><p><strong>Store 上的常用方法：</strong></p><ul><li><code>store.getState()</code> - 获取所有的状态</li><li><code>store.dispatch(action)</code> - 将 Action 对象发到 Store 中，通知执行 Reducer 函数更新状态</li><li><code>const unsubscribe = store.subscribe(() =&gt; {}) </code> - 订阅状态变化</li><li><code>unsubscribe()</code> - 取消对状态变化的订阅</li></ul><p><strong>核心代码</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span>

<span class="token comment">// 创建 store</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token comment">// 更新状态</span>
<span class="token comment">// dispatch 派遣，派出。表示：分发一个 action，也就是发起状态更新</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span>action<span class="token punctuation">)</span>

<span class="token comment">// 监听状态变化</span>
<span class="token keyword">const</span> unsubscribe <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 状态改变时，执行相应操作</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 取消监听状态变化</span>
<span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redux-的首次执行" tabindex="-1"><a class="header-anchor" href="#redux-的首次执行" aria-hidden="true">#</a> Redux 的首次执行</h2><p>如果我们测试一下，可以发现：<strong>在创建 Store 时 Reducer 函数会执行一次</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 查看首次的打印结果</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; reducer:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;increment&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;store 状态值为：&#39;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这次执行的目的是为了对 <strong>Store 中的状态进行初始化</strong>，Store 内部会发送一个随机 type 值的 Action 对象来对 Reducer 函数进行调用：</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;@@redux/INITv.a.4.t.t.p&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>这段代码的作用是：</p><ul><li>第一个参数为 <code>undefined</code>，所以这会让 Reducer 函数的第一个参数使用默认值</li><li>第二个参数 action 对象中的 type 是个随机生成的字符串，所以这会让 Reducer 函数总是执行默认的分支</li></ul><hr><h2 id="redux-整体执行流程" tabindex="-1"><a class="header-anchor" href="#redux-整体执行流程" aria-hidden="true">#</a> Redux 整体执行流程</h2><p>以下是完整的 Redux 状态更新流程：</p><ol><li>创建 store 时会先调用一次 Reducer 函数，为状态设置初始值</li><li>当要更新状态时，就要用 <code>store.dispatch(action)</code> 发送一个 Action 对象</li><li>当 Store 收到该 Action 对象后，会执行 Reducer 函数并将<code>上一次的状态</code> 和 <code>Action 对象</code> 作为参数传入，计算并返回新状态值</li><li>当 Store 执行 Reducer 函数后，会用该函数的返回值作为最新状态，替换掉旧状态</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span>

<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span>reducer<span class="token punctuation">)</span>

<span class="token keyword">function</span> <span class="token function">reducer</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;reducer:&#39;</span><span class="token punctuation">,</span> state<span class="token punctuation">,</span> action<span class="token punctuation">)</span>
  
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;increment&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;当前状态：&#39;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 10</span>

<span class="token comment">// 进行状态更新</span>
store<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;increment&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;更新后状态：&#39;</span><span class="token punctuation">,</span> store<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 11</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="react-redux-安装和配置" tabindex="-1"><a class="header-anchor" href="#react-redux-安装和配置" aria-hidden="true">#</a> react-redux：安装和配置</h2>`,79),y=n("strong",null,"目标",-1),x={href:"https://react-redux.js.org/introduction/getting-started",target:"_blank",rel:"noopener noreferrer"},h=a(`<p><strong>什么是 React-redux？</strong></p><p>Redux 其实并不是专为 React 而设计的，而是可用于任何 JS 编写的程序中。</p><p>由于通用性方面的考虑，它的原始用法有点啰嗦。</p><p>为提升 Redux 在 React 中的使用体验 ，就有了 <code>React-Redux</code> 这样的辅助库来对 React 和 Redux 进行更紧密的结合，让代码看起来更简单。</p><p><strong>安装和配置步骤：</strong></p><ol><li>安装依赖包 <code>yarn add react-redux</code></li><li>在 App 组件外层配置<code>&lt;Provider store={store}&gt;</code> 组件</li></ol><p><strong>核心代码</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">&#39;react-dom&#39;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">&#39;./App.js&#39;</span>

<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">&#39;./store/store.js&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Provider <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span>

ReactDOM<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>
  <span class="token operator">&lt;</span>Provider store<span class="token operator">=</span><span class="token punctuation">{</span>store<span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Provider<span class="token operator">&gt;</span><span class="token punctuation">,</span>
  document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#39;#root&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="react-redux-useselector" tabindex="-1"><a class="header-anchor" href="#react-redux-useselector" aria-hidden="true">#</a> react-redux：useSelector</h2><p><strong>目标</strong>：在函数组件中使用 react-redux 提供的 Hooks 函数，方便的获取 Redux 中的状态</p><ol><li><code>useSelector</code> 可以从 Store 中取出想要的状态</li><li><code>useSelector</code> 的参数是个回调函数，并且也是个纯函数 <ul><li>回调函数的参数是当前 Store 中的所有状态</li><li>回调函数的返回值是你想获取的状态</li></ul></li></ol><p><strong>核心代码</strong></p><p><code>App.js</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> addMore<span class="token punctuation">,</span> addOne<span class="token punctuation">,</span> subMore<span class="token punctuation">,</span> subOne <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./store/action&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过redux实现金钱管理</span>
  <span class="token comment">// 通过store.getState() 就可以获取到store的状态</span>
  <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>我是根组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>当前的金钱：<span class="token punctuation">{</span>money<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button<span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">10</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>要点：使用时，千万别忘了给最外层组件（App）套上 <code>&lt;Provider&gt;</code>组件</strong></p><hr><h2 id="react-redux-usedispatch" tabindex="-1"><a class="header-anchor" href="#react-redux-usedispatch" aria-hidden="true">#</a> react-redux：useDispatch</h2><p><strong>目标</strong>：使用 react-redux 提供的 Hooks 函数，修改 Redux 中的状态</p><p>调用 <code>useDispatch</code> 能获得一个 Action 发送函数，作用同 <code>store.dispatch()</code> 。</p><p><strong>核心代码</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useDispatch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useSelector <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react-redux&#39;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> addMore<span class="token punctuation">,</span> addOne<span class="token punctuation">,</span> subMore<span class="token punctuation">,</span> subOne <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./store/action&#39;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  
  <span class="token keyword">const</span> money <span class="token operator">=</span> <span class="token function">useSelector</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">)</span>
  
  <span class="token keyword">const</span> dispatch <span class="token operator">=</span> <span class="token function">useDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>我是根组件<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>当前的金钱：<span class="token punctuation">{</span>money<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
  			<span class="token punctuation">{</span><span class="token comment">/* 在点击事件中调用 dispatch 发送 Action */</span><span class="token punctuation">}</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">subOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">addMore</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">+</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">subMore</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&gt;</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="拆分与合并-reducer" tabindex="-1"><a class="header-anchor" href="#拆分与合并-reducer" aria-hidden="true">#</a> 拆分与合并 Reducer</h2><p>随着项目的规模变得越来越大，Redux 中管理的状态肯定也会越来越多。</p><p>此时有两种方式来处理状态的更新：</p><ol><li>使用一个 reducer 来处理项目中所有的状态更新</li><li>按照功能模块来划分多个 reducer，每个功能模块对应一个 reducer 处理状态更新</li></ol><p><strong>上面提到的第二种方案，是企业中推荐的方式。</strong></p><p>这能让每个 reducer 函数中处理的状态更少，职责更明确，也更好维护。</p><p><strong>具体做法：</strong></p><p>采用方案二时，项目中会有多个 reducer 函数，但创建 <strong>store 时只接收一个 reducer</strong>，因此需要将多个 reducer 函数重新合并为一个（这个 reducer 被称为根 reducer），这样才能传递给 store。</p><ul><li>合并方式：使用 Redux 提供的 <code>combineReducers</code> 函数</li><li>合并之后，所有的状态都会被放到一个对象中，并按用 <code>combineReducers</code> 合并时的结构来组织</li><li>合并之后，每个 reducer 都各自只负责各自一块的状态管理，不会互相影响</li></ul><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> combineReducers <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;redux&#39;</span>

<span class="token comment">// 一个 reducer 函数: money</span>
<span class="token keyword">function</span> <span class="token function">money</span><span class="token punctuation">(</span><span class="token parameter">state <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;addOne&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">&#39;subOne&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> <span class="token number">1</span>
    <span class="token keyword">case</span> <span class="token string">&#39;addMore&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">+</span> action<span class="token punctuation">.</span>payload
    <span class="token keyword">case</span> <span class="token string">&#39;subMore&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> state <span class="token operator">-</span> action<span class="token punctuation">.</span>payload
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token comment">// 很重要</span>
      <span class="token keyword">return</span> state
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 另一个 reducer 函数: user</span>
<span class="token keyword">function</span> <span class="token function">user</span><span class="token punctuation">(</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;zs&#39;</span><span class="token punctuation">,</span> <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">&#39;123456&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;setName&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>state<span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> action<span class="token punctuation">.</span>payload
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> state
<span class="token punctuation">}</span>

<span class="token comment">// 合并 reducers</span>
<span class="token keyword">const</span> rootReducer <span class="token operator">=</span> <span class="token function">combineReducers</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">money</span><span class="token operator">:</span> money<span class="token punctuation">,</span>
  <span class="token literal-property property">user</span><span class="token operator">:</span> user
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> rootReducer
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,33);function f(w,R){const e=o("ExternalLinkIcon");return c(),l("div",null,[u,d,k,v,n("p",null,[n("a",m,[s("Redux"),t(e)]),s(" 是 React 开发中最流行的全局状态管理工具之一。")]),b,i(' <img src="images/with-redux.png" alt="with redux" style="zoom: 50%;" /> '),g,n("p",null,[y,s("：在 react 项目中安装和配置 "),n("a",x,[s("react-redux"),t(e)]),s(" 来简化 redux 的使用")]),h])}const A=p(r,[["render",f],["__file","09-Redux基础.html.vue"]]);export{A as default};
