import{_ as n,p as s,q as a,a1 as t}from"./framework-96b046e1.js";const p={},e=t(`<h1 id="_09-人脸识别终版" tabindex="-1"><a class="header-anchor" href="#_09-人脸识别终版" aria-hidden="true">#</a> 09 人脸识别终版</h1><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code><span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">from</span> aip <span class="token keyword">import</span> AipFace
<span class="token keyword">import</span> base64
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> tkinter <span class="token keyword">as</span> tk  <span class="token comment"># 使用Tkinter前需要先导入</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
window <span class="token operator">=</span> tk<span class="token punctuation">.</span>Tk<span class="token punctuation">(</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">&#39;My Window&#39;</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>geometry<span class="token punctuation">(</span><span class="token string">&#39;500x300&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># 这里的乘是小x</span>
var <span class="token operator">=</span> tk<span class="token punctuation">.</span>StringVar<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 将label标签的内容设置为字符类型，用var来接收hit_me函数的传出内容用以显示在标签上</span>
var2 <span class="token operator">=</span> tk<span class="token punctuation">.</span>Image
l <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>window<span class="token punctuation">,</span> textvariable<span class="token operator">=</span>var<span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">&#39;green&#39;</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">&#39;white&#39;</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;Arial&#39;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment"># 说明： bg为背景，fg为字体颜色，font为字体，width为长，height为高，这里的长和高是字符的长和高，比如height=2,就是标签有2个字符这么高</span>
l<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
l2 <span class="token operator">=</span> tk<span class="token punctuation">.</span>Label<span class="token punctuation">(</span>window<span class="token punctuation">,</span> textvariable<span class="token operator">=</span>var2<span class="token punctuation">,</span> bg<span class="token operator">=</span><span class="token string">&#39;red&#39;</span><span class="token punctuation">,</span> fg<span class="token operator">=</span><span class="token string">&#39;white&#39;</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;Arial&#39;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token comment"># 说明： bg为背景，fg为字体颜色，font为字体，width为长，height为高，这里的长和高是字符的长和高，比如height=2,就是标签有2个字符这么高</span>
l2<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>
l2<span class="token punctuation">.</span>image_names<span class="token punctuation">(</span><span class="token punctuation">)</span>
var<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;开始测评后，按 [ 空格键 ] 照相&#39;</span><span class="token punctuation">)</span>

<span class="token comment"># 定义一个函数功能（内容自己自由编写），供点击Button按键时调用，调用命令参数command=函数名</span>
on_hit <span class="token operator">=</span> <span class="token boolean">False</span>


<span class="token keyword">def</span> <span class="token function">hit_me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        flag<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 读取视频的一帧  frame是图片</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&#39;Vedio Capture&#39;</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>  <span class="token comment"># 显示图片 &#39;Vedio Capture&#39;是标题</span>
        <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">&#39; &#39;</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 等待时常1ms等待按键 如果按下q键，退出</span>
            cv2<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">&#39;D:\\\\999.jpg&#39;</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span>  <span class="token comment"># 把照片写到磁盘</span>
            <span class="token keyword">break</span>
    cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 释放摄像头</span>
    <span class="token comment">#  关闭所有窗口</span>
    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
    analysis<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">analysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    var<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">&#39;测试中...&#39;</span><span class="token punctuation">)</span>
    APP_ID <span class="token operator">=</span> <span class="token string">&#39;25750753&#39;</span>
    API_KEY <span class="token operator">=</span> <span class="token string">&#39;heSFngmNEx8XOsKEz3GQTFIn&#39;</span>
    SECRET_KEY <span class="token operator">=</span> <span class="token string">&#39;7dxuKUfa9QTc2ipb4Yc3fxZhWoA6oYMy&#39;</span>
    client <span class="token operator">=</span> AipFace<span class="token punctuation">(</span>APP_ID<span class="token punctuation">,</span> API_KEY<span class="token punctuation">,</span> SECRET_KEY<span class="token punctuation">)</span>
    <span class="token comment"># 读取照片</span>
    imgFile <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">u&#39;D:\\\\999.jpg&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;rb&#39;</span><span class="token punctuation">)</span>  <span class="token comment"># r - read  b-binary  rb指用二进制方式读</span>
    img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">&#39;D:\\\\999.jpg&#39;</span><span class="token punctuation">)</span>
    imgs <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>img<span class="token punctuation">]</span><span class="token punctuation">)</span>

    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">&quot;mutil_pic&quot;</span><span class="token punctuation">,</span> imgs<span class="token punctuation">)</span>
    cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    image <span class="token operator">=</span> imgFile<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    imgFile<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    image64 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    options<span class="token punctuation">[</span><span class="token string">&#39;face_field&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;age,beauty,gender,expression&quot;</span>  <span class="token comment"># age-年龄，beauty-颜值，gender-性别</span>
    rs <span class="token operator">=</span> client<span class="token punctuation">.</span>detect<span class="token punctuation">(</span>image64<span class="token punctuation">,</span> <span class="token string">&quot;BASE64&quot;</span><span class="token punctuation">,</span> options<span class="token punctuation">)</span>
    face_list <span class="token operator">=</span> rs<span class="token punctuation">[</span><span class="token string">&#39;result&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;face_list&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># data = &#39;年龄：&#39;, face_list[&#39;age&#39;], &#39;\\n&#39;, &#39;性别：&#39;, face_list[&#39;gender&#39;][&#39;type&#39;], &#39;\\n&#39;, &#39;颜值：&#39;, face_list[&#39;beauty&#39;]</span>
    data <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;年龄：</span><span class="token interpolation"><span class="token punctuation">{</span>face_list<span class="token punctuation">[</span><span class="token string">&#39;age&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\\n性别：</span><span class="token interpolation"><span class="token punctuation">{</span>face_list<span class="token punctuation">[</span><span class="token string">&#39;gender&#39;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;type&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">\\n颜值：</span><span class="token interpolation"><span class="token punctuation">{</span>face_list<span class="token punctuation">[</span><span class="token string">&#39;beauty&#39;</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;结果如下所示：&#39;</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;---------&#39;</span><span class="token punctuation">)</span>
    var<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>


<span class="token comment"># 第5步，在窗口界面设置放置Button按键</span>
b <span class="token operator">=</span> tk<span class="token punctuation">.</span>Button<span class="token punctuation">(</span>window<span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token string">&#39;开始测评&#39;</span><span class="token punctuation">,</span> font<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&#39;Arial&#39;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> height<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> command<span class="token operator">=</span>hit_me<span class="token punctuation">)</span>
b<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 第6步，主窗口循环显示</span>
window<span class="token punctuation">.</span>mainloop<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),o=[e];function c(i,l){return s(),a("div",null,o)}const k=n(p,[["render",c],["__file","09人脸识别终版.html.vue"]]);export{k as default};
